import{_ as k}from"./FetchWrapper.vue_vue_type_script_setup_true_lang-39891d1c.js";import{d as v,l as S,q as A,o as l,c as m,w as d,a as P,m as R,n as _,u as g,t as q,N as B,i as h,X as T,P as C,f as K,A as c,S as O}from"./index-a9e6055c.js";import{T as i,R as $}from"./inputs-cac6fc85.js";import{_ as x}from"./SelectInput.vue_vue_type_script_setup_true_lang-7a244b2a.js";import{c as U,e as V,f as I,i as J,d as D}from"./inputValidators-a742f5c9.js";import{_ as F}from"./StatefulForm.vue_vue_type_script_setup_true_lang-247379b3.js";import{U as Y}from"./classes-929a4aba.js";import"./requests-8927b21a.js";import"./RadioInput.vue_vue_type_script_setup_true_lang-8f6d06c1.js";const z={class:"mt-4 my-2"},G=["onClick"],L=v({__name:"AccountForm",setup(E){const a=h(T),t=h(C),e=S({requirePassword:!1,success:"",successTimeout:-1}),y=K();function N(s){return s.length>0?D(s):""}const u=[new i("Email",a.value.email??"",U,{semanticType:"email"}),new i("Password Baru","",N,{semanticType:"password"}),new i("Nama",a.value.name??"",V),new $("Jenis Kelamin",a.value.gender?"male":"female",[{label:"Pria",value:"male"},{label:"Wanita",value:"female"}],"Pilih salah satu jenis kelamin"),new i("No. Telp",a.value.telp??"",I)],o=new i("Password","",J("Password harus diisi!"),{semanticType:"password"});function b(s){const n=s["Password Baru"].length>0;if(n&&!e.requirePassword){e.requirePassword=!0;return}n&&o.value.length==0||t.run(async()=>{const r={email:s.Email,password:s["Password Baru"],name:s.Nama,gender:s["Jenis Kelamin"]=="male",telp:s["No. Telp"]};n&&(r.verify=o.value);const f=await fetch(`${c}/accounts`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),credentials:"include"});if(!f.ok){let p=O;try{p=(await f.json()).message}catch(w){console.error(w)}throw new Error(p)}e.success="Sukses mengubah informasi akun",clearTimeout(e.successTimeout),e.successTimeout=setTimeout(()=>{e.success=""},3e3),e.requirePassword=!1,u[1].error="",u[1].value="",a.value.email=r.email,a.value.name=r.name,a.value.gender=r.gender,a.value.telp=r.telp})}async function j(){if(!e.requirePassword){e.requirePassword=!0;return}o.value.length!=0&&t.run(async()=>{const s=await fetch(c+"/accounts",{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:o.value})});if(s.ok)await fetch(c+"/accounts/logout",{method:"POST",credentials:"include"}),y.replace({name:"login"});else{const{message:n}=await s.json();throw new Error(n)}})}return A(()=>{clearTimeout(e.successTimeout)}),(s,n)=>(l(),m(F,{class:"center-screen",onSubmit:b,action:"#",method:"put",inputs:u,purpose:"Simpan",validateFromStart:""},{after:d(()=>[P(R,{success:"",message:e.success},null,8,["message"])]),footer:d(()=>[_("div",z,[e.requirePassword?(l(),m(x,{key:0,input:g(o),shouldValidate:""},null,8,["input"])):q("",!0),_("button",{class:"btn btn-danger w-100 fs-5",onClick:B(j,["prevent"])},"Delete Akun",8,G)])]),_:1}))}}),te=v({__name:"App",setup(E){async function a(){const t=await fetch(c+"/accounts",{credentials:"include"});if(!t.ok)throw t;const e=await t.json();return new Y(e.id,e.email,e.name,e.gender,e.telp)}return(t,e)=>(l(),m(k,{fn:a,injectKey:g(T)},{default:d(()=>[P(L)]),_:1},8,["injectKey"]))}});export{te as default};
