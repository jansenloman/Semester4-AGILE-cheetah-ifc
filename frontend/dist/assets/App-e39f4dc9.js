import{M as C}from"./classes-929a4aba.js";import{s as I}from"./requests-8927b21a.js";import{d as w,l as b,i as y,O,p as j,q as S,s as p,P as R,o as s,c as _,w as k,b as l,t as D,v as M,x as h,n as c,F as $,y as x,z as L,u as v,A as T,S as P,B as V,a as N,T as A,D as q}from"./index-a9e6055c.js";import{_ as B}from"./IconButton.vue_vue_type_style_index_0_lang-60770588.js";import{_ as J}from"./Accordion.vue_vue_type_style_index_0_lang-c901b059.js";import{_ as z}from"./OrderListItem.vue_vue_type_script_setup_true_lang-8ae4ca92.js";const F={key:0,class:"badge text-bg-warning me-5"},K={key:1,class:"badge text-bg-info me-5"},Y={class:"list-group mx-3"},H={class:"my-2 mx-3 w-100"},U=c("b",null,"Total: ",-1),W=w({__name:"OngoingOrder",props:{order:null},setup(i){const e=i,n=b({timeDiff:new Date().getTime()-e.order.time.getTime(),intervalID:-1}),u=y(O);j(()=>{n.intervalID=setInterval(()=>{n.timeDiff=new Date().getTime()-e.order.time.getTime(),n.timeDiff>=60*60*1e3&&clearInterval(n.intervalID)},1*60*1e3)}),S(()=>{clearInterval(n.intervalID)});const f=p(()=>n.timeDiff>=60*60*1e3?"flashingred":n.timeDiff<=1*60*1e3?"flashing":""),m=y(R);async function o(){m.run(async()=>{if(e.order.phase=="cooking"&&u.remove(e.order),e.order.phase=C.parseStatus(e.order.toStatus()-1),!(await fetch(`${T}/orders/${e.order.id}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:e.order.toStatus()})})).ok)throw new Error(P)})}async function g(){const t=prompt("Apa alasan dari pembatalan pesanan ini?");m.run(async()=>{if(!(await fetch(`${T}/orders/${e.order.id}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reason:t})})).ok)throw new Error(P);u.remove(e.order)})}return(t,d)=>(s(),_(J,{class:L(v(f))},{header:k(()=>[i.order.phase=="pending"?(s(),l("span",F,"Pending")):D("",!0),i.order.phase=="cooking"?(s(),l("span",K,"Cooking")):D("",!0),M(" "+h(`${i.order.timeString} | Pesanan oleh ${i.order.username}`),1)]),default:k(()=>[c("ul",Y,[(s(!0),l($,null,x(i.order.orders,a=>(s(),_(z,{item:a},null,8,["item"]))),256))]),c("div",H,[U,M(" "+h(i.order.hargaTotal),1)]),i.order.phase=="pending"?(s(),l("button",{key:0,class:"mx-3 btn btn-warning",onClick:o},"Pesanan Sedang Dimasak")):D("",!0),i.order.phase=="cooking"?(s(),l("button",{key:1,class:"mx-3 btn btn-info",onClick:o},"Pesanan Selesai")):D("",!0),c("button",{class:"mx-3 btn btn-danger",onClick:g},"Batal Pesanan")]),_:1},8,["class"]))}});const Q={class:"list-group-item d-flex justify-content-between tss-bg-secondary my-1 sleek-shadow"},X={class:"text-start w-100"},Z=c("hr",null,null,-1),ee={class:"text-muted chef-mode-notes-list ms-4 p-0"},te={class:"tss-bg-primary rounded px-4 py-2"},ne={class:"fs-4"},se=w({__name:"ChefModeListItem",props:{item:null,earliest:null},setup(i){const e=i,n=b({intervalID:-1,timeDiff:new Date().getTime()-e.earliest.getTime()}),u=p(()=>e.item.note.split(`
`));p(()=>e.earliest.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",hour12:!1}));const f=p(()=>n.timeDiff<1*60*60*1e3?`${Math.ceil(n.timeDiff/(60*1e3))} menit yang lalu`:`${Math.ceil(n.timeDiff/(60*60*1e3))} jam yang lalu`);return j(()=>{n.intervalID=setInterval(()=>{n.timeDiff=new Date().getTime()-e.earliest.getTime()},60*1e3)}),S(()=>{clearInterval(n.intervalID)}),(m,o)=>(s(),l("li",Q,[c("div",X,[c("b",null,h(i.item.name),1),Z,c("ul",ee,[(s(!0),l($,null,x(v(u),g=>(s(),l("li",null,h(g),1))),256))])]),c("div",te,[c("div",ne,"x"+h(i.item.quantity),1),c("div",{class:L(["fs-6",{"text-danger":n.timeDiff>1*60*60*1e3}])},"Dari "+h(v(f)),3)])]))}});const ae={class:"mx-3 mx-lg-5 mt-4"},re={class:"mb-4 ms-2"},ie={key:0},oe={key:1},le=w({__name:"View",setup(i){const e=b({isChefMode:!1}),n=y(O),u=y(V);return I.on("newOrder",f=>{n.add(C.fromJSON(f))}),S(()=>{I.off("newOrder")}),(f,m)=>(s(),l("div",ae,[c("div",re,[e.isChefMode?(s(),_(B,{key:1,icon:"/storefront.svg",semantic:"Store Mode",class:"btn-primary",onClick:m[1]||(m[1]=o=>e.isChefMode=!1)})):(s(),_(B,{key:0,icon:"/restaurant.svg",semantic:"Chef Mode",class:"btn-primary",onClick:m[0]||(m[0]=o=>e.isChefMode=!0)}))]),e.isChefMode?(s(),l("div",ie,[N(A,{name:"list-slide-left",tag:"ul",class:"list-group"},{default:k(()=>[(s(!0),l($,null,x(v(u),o=>(s(),_(se,{item:o.order,earliest:o.earliest,key:o.order.id},null,8,["item","earliest"]))),128))]),_:1})])):(s(),l("div",oe,[N(A,{name:"list-slide-left"},{default:k(()=>[(s(!0),l($,null,x(v(n).data,o=>(s(),_(W,{order:o,key:o.id},null,8,["order"]))),128))]),_:1})]))]))}}),he=w({__name:"App",setup(i){const e=b({data:[],add:u,remove:f}),n=y(R);function u(t){e.data.push(t)}function f(t){const d=e.data.findIndex(a=>a.id==t.id);d!=-1&&e.data.splice(d,1)}function m(){n.run(async()=>{const t=await fetch(T+"/orders/chef",{credentials:"include"});if(!t.ok)throw t;const d=await t.json();e.data=C.fromJSONArray(d)})}function o(t){return new Date().getTime()-t.getDate()>1*60*60*1e3}const g=p(()=>{const t={};for(let a of e.data)for(let r of a.orders)t.hasOwnProperty(r.name)?(t[r.name].order.quantity+=r.quantity,t[r.name].recipients.includes(a.username)||(t[r.name].order.note+=`
(oleh: ${a.username}) ${r.note}`,t[r.name].recipients.push(a.username)),t[r.name].earliest=t[r.name].earliest.getTime()<=a.time.getTime()?t[r.name].earliest:a.time):(t[r.name]={order:r.copy(),earliest:a.time,recipients:[a.username]},t[r.name].order.note=`(oleh: ${a.username}) ${r.note}`);const d=[];for(let a in t)d.push(t[a]);return d.sort((a,r)=>{const E=o(a.earliest),G=o(r.earliest);return E==G?r.order.quantity-a.order.quantity:E?-1:1}),d});return m(),q(O,e),q(V,g),(t,d)=>(s(),_(le))}});export{he as default};
